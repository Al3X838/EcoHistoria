{% extends "base.html" %}

{% block title %}Mi Perfil - UCA Verde{% endblock %}

{% block content %}
<div class="profile-container">
    <!-- User Info Card -->
    <div class="profile-header-card">
        <div class="profile-avatar-section">
            <div class="profile-avatar">{{ current_user.nombre_completo[0] }}</div>
            <div class="profile-level-badge">{{ current_user.nivel }}</div>
        </div>
        <div class="profile-info-section">
            <h1 class="profile-name">{{ current_user.nombre_completo }}</h1>
            <p class="profile-username">@{{ current_user.username }}</p>
            <div class="profile-meta">
                <span class="profile-meta-item">ğŸ“§ {{ current_user.email }}</span>
                <span class="profile-meta-item">ğŸ›ï¸ {{ current_user.facultad }}</span>
                <span class="profile-meta-item">ğŸ“ {{ current_user.carrera }}</span>
            </div>
        </div>
        <div class="profile-stats-section">
            <div class="profile-stat">
                <div class="profile-stat-value">{{ current_user.puntos_totales }}</div>
                <div class="profile-stat-label">Puntos</div>
            </div>
            <div class="profile-stat">
                <div class="profile-stat-value">{{ current_user.racha_actual }}</div>
                <div class="profile-stat-label">Racha</div>
            </div>
            <div class="profile-stat">
                <div class="profile-stat-value">{{ total_reciclajes }}</div>
                <div class="profile-stat-label">Reciclajes</div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="profile-content-grid">
        <!-- Environmental Impact -->
        <div class="profile-card impact-card">
            <h2 class="profile-card-title">
                <span class="card-icon">ğŸŒ</span>
                Tu Impacto Ambiental
            </h2>
            <div class="impact-stats">
                <div class="impact-stat">
                    <div class="impact-icon">ğŸ’¨</div>
                    <div class="impact-data">
                        <div class="impact-value">{{ impacto.co2_evitado }} kg</div>
                        <div class="impact-label">COâ‚‚ Evitado</div>
                        <div class="impact-equiv">â‰ˆ {{ (impacto.co2_evitado / 0.404)|round(1) }} km en auto</div>
                    </div>
                </div>
                <div class="impact-stat">
                    <div class="impact-icon">ğŸ’§</div>
                    <div class="impact-data">
                        <div class="impact-value">{{ impacto.agua_ahorrada }} L</div>
                        <div class="impact-label">Agua Ahorrada</div>
                        <div class="impact-equiv">â‰ˆ {{ (impacto.agua_ahorrada / 8)|round(0)|int }} duchas</div>
                    </div>
                </div>
                <div class="impact-stat">
                    <div class="impact-icon">ğŸŒ³</div>
                    <div class="impact-data">
                        <div class="impact-value">{{ impacto.arboles_salvados }}</div>
                        <div class="impact-label">Ãrboles Salvados</div>
                        <div class="impact-equiv">AbsorciÃ³n anual de COâ‚‚</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Stats -->
        <div class="profile-card activity-card">
            <h2 class="profile-card-title">
                <span class="card-icon">ğŸ“Š</span>
                EstadÃ­sticas
            </h2>
            <div class="activity-list">
                <div class="activity-item">
                    <span class="activity-icon">â™»ï¸</span>
                    <span class="activity-name">Reciclajes</span>
                    <span class="activity-value">{{ total_reciclajes }}</span>
                </div>
                <div class="activity-item">
                    <span class="activity-icon">ğŸ“š</span>
                    <span class="activity-name">Quizzes</span>
                    <span class="activity-value">{{ total_quizzes }}</span>
                </div>
                <div class="activity-item">
                    <span class="activity-icon">ğŸ</span>
                    <span class="activity-name">Canjes</span>
                    <span class="activity-value">{{ total_canjes }}</span>
                </div>
                <div class="activity-item">
                    <span class="activity-icon">ğŸ”¥</span>
                    <span class="activity-name">Racha Actual</span>
                    <span class="activity-value">{{ current_user.racha_actual }} dÃ­as</span>
                </div>
            </div>
        </div>

        <!-- Achievements -->
        <div class="profile-card achievements-card">
            <h2 class="profile-card-title">
                <span class="card-icon">ğŸ†</span>
                Mis Logros <span class="achievement-count">({{ logros_obtenidos|length }}/{{ todos_logros|length
                    }})</span>
            </h2>
            <div class="achievements-grid">
                {% for logro in todos_logros %}
                {% set unlocked = logro.id in logros_obtenidos %}
                <a href="{{ url_for('main.logro_detalle', logro_id=logro.id) if unlocked else '#' }}"
                    class="achievement-item {{ 'unlocked' if unlocked else 'locked' }}"
                    title="{{ logro.descripcion if unlocked else 'Logro bloqueado' }}">
                    <div class="achievement-icon">{{ logro.icono if unlocked else 'ğŸ”’' }}</div>
                    <div class="achievement-name">{{ logro.nombre }}</div>
                </a>
                {% endfor %}
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="profile-card transactions-card">
            <h2 class="profile-card-title">
                <span class="card-icon">ğŸ“œ</span>
                Transacciones Recientes
            </h2>
            {% if transacciones %}
            <div class="transactions-list">
                {% for trans in transacciones[:10] %}
                <div class="transaction-item">
                    <div class="transaction-icon {{ trans.tipo }}">
                        {% if trans.tipo == 'reciclaje' %}â™»ï¸
                        {% elif trans.tipo == 'quiz' %}ğŸ“š
                        {% elif trans.tipo == 'evento' %}ğŸ‰
                        {% elif trans.tipo == 'canje' %}ğŸ
                        {% elif trans.tipo == 'casino' %}ğŸ°
                        {% endif %}
                    </div>
                    <div class="transaction-info">
                        <div class="transaction-desc">{{ trans.descripcion }}</div>
                        <div class="transaction-date">{{ trans.fecha.strftime('%d/%m/%Y %H:%M') }}</div>
                    </div>
                    <div class="transaction-points {{ 'positive' if trans.puntos > 0 else 'negative' }}">
                        {{ '+' if trans.puntos > 0 else '' }}{{ trans.puntos }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% if transacciones|length > 10 %}
            <p class="transactions-note">Mostrando las Ãºltimas 10 de {{ transacciones|length }} transacciones</p>
            {% endif %}
            {% else %}
            <p class="empty-state">No tienes transacciones registradas aÃºn.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}