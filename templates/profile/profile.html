{% extends "base.html" %}

{% block title %}Mi Perfil - UCA Verde{% endblock %}

{% block content %}
<div class="profile-container">
    <!-- User Info Card -->
    <div class="profile-header-card">
        <div class="profile-avatar-section">
            <div class="profile-avatar">{{ current_user.nombre_completo[0] }}</div>
            <div class="profile-level-badge">{{ current_user.nivel }}</div>
        </div>
        <div class="profile-info-section">
            <h1 class="profile-name">{{ current_user.nombre_completo }}</h1>
            <p class="profile-username">@{{ current_user.username }}</p>
            <div class="profile-meta">
                <span class="profile-meta-item">üìß {{ current_user.email }}</span>
                <span class="profile-meta-item">üèõÔ∏è {{ current_user.facultad }}</span>
                <span class="profile-meta-item">üéì {{ current_user.carrera }}</span>
            </div>
        </div>
        <div class="profile-stats-section">
            <div class="profile-stat">
                <div class="profile-stat-value">{{ current_user.puntos_totales }}</div>
                <div class="profile-stat-label">Puntos</div>
            </div>
            <div class="profile-stat">
                <div class="profile-stat-value">{{ current_user.racha_actual }}</div>
                <div class="profile-stat-label">Racha</div>
            </div>
            <div class="profile-stat">
                <div class="profile-stat-value">{{ total_reciclajes }}</div>
                <div class="profile-stat-label">Reciclajes</div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="profile-content-grid">
        <!-- Environmental Impact -->
        <div class="profile-card impact-card">
            <h2 class="profile-card-title">
                <span class="card-icon">üåç</span>
                Tu Impacto Ambiental
            </h2>
            <div class="impact-stats">
                <div class="impact-stat">
                    <div class="impact-icon">üí®</div>
                    <div class="impact-data">
                        <div class="impact-value">{{ impacto.co2_evitado }} kg</div>
                        <div class="impact-label">CO‚ÇÇ Evitado</div>
                        <div class="impact-equiv">‚âà {{ (impacto.co2_evitado / 0.404)|round(1) }} km en auto</div>
                    </div>
                </div>
                <div class="impact-stat">
                    <div class="impact-icon">üíß</div>
                    <div class="impact-data">
                        <div class="impact-value">{{ impacto.agua_ahorrada }} L</div>
                        <div class="impact-label">Agua Ahorrada</div>
                        <div class="impact-equiv">‚âà {{ (impacto.agua_ahorrada / 8)|round(0)|int }} duchas</div>
                    </div>
                </div>
                <div class="impact-stat">
                    <div class="impact-icon">üå≥</div>
                    <div class="impact-data">
                        <div class="impact-value">{{ impacto.arboles_salvados }}</div>
                        <div class="impact-label">√Årboles Salvados</div>
                        <div class="impact-equiv">Absorci√≥n anual de CO‚ÇÇ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Stats -->
        <div class="profile-card activity-card">
            <h2 class="profile-card-title">
                <span class="card-icon">üìä</span>
                Estad√≠sticas
            </h2>
            <div class="activity-list">
                <div class="activity-item">
                    <span class="activity-icon">‚ôªÔ∏è</span>
                    <span class="activity-name">Reciclajes</span>
                    <span class="activity-value">{{ total_reciclajes }}</span>
                </div>
                <div class="activity-item">
                    <span class="activity-icon">üìö</span>
                    <span class="activity-name">Quizzes</span>
                    <span class="activity-value">{{ total_quizzes }}</span>
                </div>
                <div class="activity-item">
                    <span class="activity-icon">üéÅ</span>
                    <span class="activity-name">Canjes</span>
                    <span class="activity-value">{{ total_canjes }}</span>
                </div>
                <div class="activity-item">
                    <span class="activity-icon">üî•</span>
                    <span class="activity-name">Racha Actual</span>
                    <span class="activity-value">{{ current_user.racha_actual }} d√≠as</span>
                </div>
            </div>
        </div>

        <!-- Achievements -->
        <div class="profile-card achievements-card">
            <h2 class="profile-card-title">
                <span class="card-icon">üèÜ</span>
                Mis Logros <span class="achievement-count">({{ logros_obtenidos|length }}/{{ todos_logros|length
                    }})</span>
            </h2>
            <div class="achievements-grid">
                {% for logro in todos_logros %}
                {% set unlocked = logro.id in logros_obtenidos %}
                <a href="{{ url_for('main.logro_detalle', logro_id=logro.id) if unlocked else '#' }}"
                    class="achievement-item {{ 'unlocked' if unlocked else 'locked' }}"
                    title="{{ logro.descripcion if unlocked else 'Logro bloqueado' }}">
                    <div class="achievement-icon">{{ logro.icono if unlocked else 'üîí' }}</div>
                    <div class="achievement-name">{{ logro.nombre }}</div>
                </a>
                {% endfor %}
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="profile-card transactions-card">
            <h2 class="profile-card-title">
                <span class="card-icon">üìú</span>
                Transacciones Recientes
            </h2>
            {% if transacciones %}
            <div class="transactions-list">
                {% for trans in transacciones[:10] %}
                <div class="transaction-item">
                    <div class="transaction-icon {{ trans.tipo }}">
                        {% if trans.tipo == 'reciclaje' %}‚ôªÔ∏è
                        {% elif trans.tipo == 'quiz' %}üìö
                        {% elif trans.tipo == 'evento' %}üéâ
                        {% elif trans.tipo == 'canje' %}üéÅ
                        {% elif trans.tipo == 'casino' %}üé∞
                        {% endif %}
                    </div>
                    <div class="transaction-info">
                        <div class="transaction-desc">{{ trans.descripcion }}</div>
                        <div class="transaction-date">{{ trans.fecha.strftime('%d/%m/%Y %H:%M') }}</div>
                    </div>
                    <div class="transaction-points {{ 'positive' if trans.puntos > 0 else 'negative' }}">
                        {{ '+' if trans.puntos > 0 else '' }}{{ trans.puntos }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% if transacciones|length > 10 %}
            <p class="transactions-note">Mostrando las √∫ltimas 10 de {{ transacciones|length }} transacciones</p>
            {% endif %}
            {% else %}
            <p class="empty-state">No tienes transacciones registradas a√∫n.</p>
            {% endif %}
        </div>
<<<<<<< HEAD
    </div>
</div>
=======
    </div> <!-- Cierre de profile-grid -->

    <!-- üëá SECCI√ìN DE SEGURIDAD (V11 - SIN EMOJIS Y CENTRADO REAL) üëá -->
    <div class="row" style="margin-top: 3rem; margin-bottom: 3rem;">
        <div class="col-md-8 offset-md-2">
            <div class="card" style="background: linear-gradient(145deg, #1f2937, #111827); border: 1px solid #374151; border-radius: 20px; box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.4); overflow: hidden;">
                
                <!-- Barra decorativa -->
                <div style="height: 6px; background: linear-gradient(90deg, #10b981, #047857);"></div>

                <!-- Encabezado -->
                <div class="card-header" style="border: none; background: transparent; padding-top: 2rem; text-align: center;">
                    <h3 style="color: #10b981; font-weight: 800; font-size: 1.6rem; margin-bottom: 0.5rem; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <span>üîí</span> {{ _('Zona de Seguridad') }}
                    </h3>
                    <p style="color: #9ca3af; font-size: 0.9rem; margin: 0;">
                        {{ _('Mant√©n tu cuenta segura cambiando tu contrase√±a peri√≥dicamente.') }}
                    </p>
                </div>

                <div class="card-body" style="padding: 2rem;">
                    <form method="POST" style="max-width: 500px; margin: 0 auto;">
                        {{ form.hidden_tag() }}
                        
                        <!-- Contrase√±a Actual (SIN EMOJIS) -->
                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label" style="color: #d1fae5; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; display: block;">
                                {{ form.current_password.label }}
                            </label>
                            {% if form.current_password.errors %}
                                {{ form.current_password(class="form-control is-invalid", style="background-color: #111827; border: 1px solid #ef4444; color: white; padding: 12px; border-radius: 10px; width: 100%; box-sizing: border-box;") }}
                                <div style="color: #ef4444; margin-top: 5px; font-size: 0.85rem;">
                                    {{ form.current_password.errors[0] }}
                                </div>
                            {% else %}
                                {{ form.current_password(class="form-control", style="background-color: #111827; border: 1px solid #374151; color: white; padding: 12px; border-radius: 10px; width: 100%; box-sizing: border-box;") }}
                            {% endif %}
                        </div>

                        <!-- Nueva Contrase√±a (SIN EMOJIS) -->
                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label" style="color: #d1fae5; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; display: block;">
                                {{ form.new_password.label }}
                            </label>
                            {% if form.new_password.errors %}
                                {{ form.new_password(class="form-control is-invalid", style="background-color: #111827; border: 1px solid #ef4444; color: white; padding: 12px; border-radius: 10px; width: 100%; box-sizing: border-box;") }}
                                <div style="color: #ef4444; margin-top: 5px; font-size: 0.85rem;">
                                    {{ form.new_password.errors[0] }}
                                </div>
                            {% else %}
                                {{ form.new_password(class="form-control", style="background-color: #111827; border: 1px solid #374151; color: white; padding: 12px; border-radius: 10px; width: 100%; box-sizing: border-box;") }}
                            {% endif %}
                        </div>

                        <!-- Confirmar Contrase√±a (SIN EMOJIS) -->
                        <div style="margin-bottom: 1.5rem;">
                            <label class="form-label" style="color: #d1fae5; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; display: block;">
                                {{ form.confirm_password.label }}
                            </label>
                            {% if form.confirm_password.errors %}
                                {{ form.confirm_password(class="form-control is-invalid", style="background-color: #111827; border: 1px solid #ef4444; color: white; padding: 12px; border-radius: 10px; width: 100%; box-sizing: border-box;") }}
                                <div style="color: #ef4444; margin-top: 5px; font-size: 0.85rem;">
                                    {{ form.confirm_password.errors[0] }}
                                </div>
                            {% else %}
                                {{ form.confirm_password(class="form-control", style="background-color: #111827; border: 1px solid #374151; color: white; padding: 12px; border-radius: 10px; width: 100%; box-sizing: border-box;") }}
                            {% endif %}
                        </div>

                        <!-- Bot√≥n Centrado y Separado -->
                        <div style="text-align: center; margin-top: 2.5rem;">
                            {{ form.submit(class="btn", style="background: linear-gradient(90deg, #10b981, #059669); border: none; border-radius: 50px; padding: 12px 40px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); transition: transform 0.2s; display: inline-block; cursor: pointer;") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div> <!-- Cierre de container -->
>>>>>>> origin/Asad
{% endblock %}