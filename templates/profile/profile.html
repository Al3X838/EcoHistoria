{% extends "base.html" %}

{% block title %}Mi Perfil - UCA Verde{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1 class="page-title">
            <span class="icon">ğŸ‘¤</span> Mi Perfil
        </h1>
    </div>

    <div class="profile-grid">
        <!-- InformaciÃ³n del Usuario -->
        <div class="card profile-info-card">
            <div class="profile-avatar">
                <div class="avatar-large">{{ current_user.nombre_completo[0] }}</div>
            </div>
            <h2 class="profile-name">{{ current_user.nombre_completo }}</h2>
            <p class="profile-username">@{{ current_user.username }}</p>
            
            <div class="profile-details">
                <div class="detail-item">
                    <span class="detail-icon">ğŸ“§</span>
                    <span class="detail-text">{{ current_user.email }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-icon">ğŸ›ï¸</span>
                    <span class="detail-text">{{ current_user.facultad }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-icon">ğŸ“</span>
                    <span class="detail-text">{{ current_user.carrera }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-icon">ğŸ“…</span>
                    <span class="detail-text">Miembro desde {{ current_user.fecha_registro.strftime('%d/%m/%Y') }}</span>
                </div>
            </div>

            <div class="profile-stats-mini">
                <div class="stat-mini">
                    <div class="stat-value">{{ current_user.puntos_totales }}</div>
                    <div class="stat-label">Puntos</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-value">{{ current_user.racha_actual }}</div>
                    <div class="stat-label">Racha</div>
                </div>
                <div class="stat-mini">
                    <div class="stat-value">{{ total_reciclajes }}</div>
                    <div class="stat-label">Reciclajes</div>
                </div>
            </div>

            <div class="profile-level">
                <span class="level-badge-large">{{ current_user.nivel }}</span>
            </div>
        </div>

        <!-- Impacto Ambiental -->
        <div class="card impact-card">
            <h3 class="card-title">ğŸŒ Tu Impacto Ambiental Total</h3>
            <div class="impact-grid">
                <div class="impact-item-large">
                    <div class="impact-icon-large">ğŸ’¨</div>
                    <div class="impact-value-large">{{ impacto.co2_evitado }} kg</div>
                    <div class="impact-label-large">COâ‚‚ Evitado</div>
                    <p class="impact-desc">Equivalente a {{ (impacto.co2_evitado / 0.404)|round(1) }} km en auto</p>
                </div>
                <div class="impact-item-large">
                    <div class="impact-icon-large">ğŸ’§</div>
                    <div class="impact-value-large">{{ impacto.agua_ahorrada }} L</div>
                    <div class="impact-label-large">Agua Ahorrada</div>
                    <p class="impact-desc">Equivalente a {{ (impacto.agua_ahorrada / 8)|round(0)|int }} duchas</p>
                </div>
                <div class="impact-item-large">
                    <div class="impact-icon-large">ğŸŒ³</div>
                    <div class="impact-value-large">{{ impacto.arboles_salvados }}</div>
                    <div class="impact-label-large">Ãrboles Salvados</div>
                    <p class="impact-desc">AbsorciÃ³n de COâ‚‚ anual equivalente</p>
                </div>
            </div>
        </div>

        <!-- EstadÃ­sticas de Actividad -->
        <div class="card activity-stats-card">
            <h3 class="card-title">ğŸ“Š EstadÃ­sticas de Actividad</h3>
            <div class="activity-stats-list">
                <div class="activity-stat-item">
                    <span class="activity-icon">â™»ï¸</span>
                    <span class="activity-name">Reciclajes</span>
                    <span class="activity-value">{{ total_reciclajes }}</span>
                </div>
                <div class="activity-stat-item">
                    <span class="activity-icon">ğŸ“š</span>
                    <span class="activity-name">Quizzes</span>
                    <span class="activity-value">{{ total_quizzes }}</span>
                </div>
                <div class="activity-stat-item">
                    <span class="activity-icon">ğŸ</span>
                    <span class="activity-name">Canjes</span>
                    <span class="activity-value">{{ total_canjes }}</span>
                </div>
                <div class="activity-stat-item">
                    <span class="activity-icon">ğŸ”¥</span>
                    <span class="activity-name">Racha Actual</span>
                    <span class="activity-value">{{ current_user.racha_actual }} dÃ­as</span>
                </div>
            </div>
        </div>

        <!-- Logros -->
        <div class="card achievements-card">
            <h3 class="card-title">ğŸ† Mis Logros ({{ logros_obtenidos|length }}/{{ todos_logros|length }})</h3>
            <div class="achievements-grid-new">
                {% for logro in todos_logros %}
                    {% set unlocked = logro.id in logros_obtenidos %}
                    <a href="{{ url_for('main.logro_detalle', logro_id=logro.id) if unlocked else '#' }}" 
                       class="achievement-badge {{ 'unlocked' if unlocked else 'locked' }}"
                       title="{{ logro.descripcion if unlocked else 'Logro bloqueado' }}">
                        
                        <div class="achievement-badge-icon">
                            {{ logro.icono if unlocked else 'ğŸ”’' }}
                        </div>
                        <div class="achievement-badge-info">
                            <h4 class="achievement-badge-name">{{ logro.nombre }}</h4>
                            {% if unlocked %}
                                <span class="achievement-badge-status">Desbloqueado</span>
                            {% else %}
                                <span class="achievement-badge-status">Bloqueado</span>
                            {% endif %}
                        </div>
                    </a>
                {% endfor %}
            </div>
        </div>

        <!-- Historial de Transacciones -->
        <div class="card transactions-card">
            <h3 class="card-title">ğŸ“œ Historial Completo de Transacciones</h3>
            {% if transacciones %}
                <div class="transactions-list">
                    {% for trans in transacciones[:20] %}
                    <div class="transaction-item">
                        <div class="transaction-icon {{ trans.tipo }}">
                            {% if trans.tipo == 'reciclaje' %}â™»ï¸
                            {% elif trans.tipo == 'quiz' %}ğŸ“š
                            {% elif trans.tipo == 'evento' %}ğŸ‰
                            {% elif trans.tipo == 'canje' %}ğŸ
                            {% elif trans.tipo == 'casino' %}ğŸ°
                            {% endif %}
                        </div>
                        <div class="transaction-content">
                            <p class="transaction-desc">{{ trans.descripcion }}</p>
                            <p class="transaction-date">{{ trans.fecha.strftime('%d/%m/%Y %H:%M') }}</p>
                        </div>
                        <div class="transaction-points {{ 'positive' if trans.puntos > 0 else 'negative' }}">
                            {{ '+' if trans.puntos > 0 else '' }}{{ trans.puntos }} pts
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% if transacciones|length > 20 %}
                    <p class="text-center" style="margin-top: 1rem; color: #6b7280;">
                        Mostrando las Ãºltimas 20 transacciones de {{ transacciones|length }} totales
                    </p>
                {% endif %}
            {% else %}
                <p class="empty-state">No tienes transacciones registradas aÃºn.</p>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}